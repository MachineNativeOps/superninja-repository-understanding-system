# Communication Module Specification
# Defines interface and behavior contracts

version: "2.0.0"
semantic_role: specification_definitions
artifact_type: spec
semantic_root: false

interfaces:
  MessageBus:
    description: "Core message bus for pub-sub messaging"
    methods:
      publish:
        description: "Publish a message to a topic"
        parameters:
          - name: "topic"
            type: "string"
            required: true
            description: "Topic name"
          - name: "message"
            type: "Message"
            required: true
            description: "Message to publish"
        returns:
          type: "Promise<string>"
          description: "Message ID"
        errors:
          - code: "INVALID_TOPIC"
            description: "Topic name is invalid"
          - code: "PUBLISH_FAILED"
            description: "Failed to publish message"
      
      subscribe:
        description: "Subscribe to a topic"
        parameters:
          - name: "topic"
            type: "string"
            required: true
            description: "Topic name or pattern"
          - name: "handler"
            type: "MessageHandler"
            required: true
            description: "Message handler function"
        returns:
          type: "string"
          description: "Subscription ID"
        errors:
          - code: "INVALID_TOPIC"
            description: "Topic name is invalid"
          - code: "SUBSCRIBE_FAILED"
            description: "Failed to subscribe"
      
      unsubscribe:
        description: "Unsubscribe from a topic"
        parameters:
          - name: "subscriptionId"
            type: "string"
            required: true
            description: "Subscription ID"
        returns:
          type: "boolean"
          description: "Success status"

  EventEmitter:
    description: "Event emitter for event-driven architecture"
    methods:
      emit:
        description: "Emit an event"
        parameters:
          - name: "eventName"
            type: "string"
            required: true
            description: "Event name"
          - name: "data"
            type: "any"
            required: false
            description: "Event data"
        returns:
          type: "boolean"
          description: "Success status"
      
      on:
        description: "Register event listener"
        parameters:
          - name: "eventName"
            type: "string"
            required: true
            description: "Event name"
          - name: "listener"
            type: "EventListener"
            required: true
            description: "Event listener function"
        returns:
          type: "void"
      
      off:
        description: "Remove event listener"
        parameters:
          - name: "eventName"
            type: "string"
            required: true
            description: "Event name"
          - name: "listener"
            type: "EventListener"
            required: true
            description: "Event listener function"
        returns:
          type: "void"
      
      once:
        description: "Register one-time event listener"
        parameters:
          - name: "eventName"
            type: "string"
            required: true
            description: "Event name"
          - name: "listener"
            type: "EventListener"
            required: true
            description: "Event listener function"
        returns:
          type: "void"

  TopicManager:
    description: "Topic management for pub-sub"
    methods:
      createTopic:
        description: "Create a new topic"
        parameters:
          - name: "name"
            type: "string"
            required: true
            description: "Topic name"
          - name: "options"
            type: "TopicOptions"
            required: false
            description: "Topic options"
        returns:
          type: "Topic"
          description: "Created topic"
      
      deleteTopic:
        description: "Delete a topic"
        parameters:
          - name: "name"
            type: "string"
            required: true
            description: "Topic name"
        returns:
          type: "boolean"
          description: "Success status"
      
      listTopics:
        description: "List all topics"
        parameters: []
        returns:
          type: "Topic[]"
          description: "Array of topics"
      
      getTopicStats:
        description: "Get topic statistics"
        parameters:
          - name: "name"
            type: "string"
            required: true
            description: "Topic name"
        returns:
          type: "TopicStats"
          description: "Topic statistics"

  MessageQueue:
    description: "Priority message queue"
    methods:
      enqueue:
        description: "Add message to queue"
        parameters:
          - name: "message"
            type: "QueueMessage"
            required: true
            description: "Message to enqueue"
        returns:
          type: "Promise<string>"
          description: "Message ID"
      
      dequeue:
        description: "Remove message from queue"
        parameters: []
        returns:
          type: "Promise<QueueMessage | null>"
          description: "Dequeued message or null"
      
      peek:
        description: "View next message without removing"
        parameters: []
        returns:
          type: "QueueMessage | null"
          description: "Next message or null"
      
      size:
        description: "Get queue size"
        parameters: []
        returns:
          type: "number"
          description: "Number of messages in queue"
      
      clear:
        description: "Clear all messages from queue"
        parameters: []
        returns:
          type: "void"

behavior_contracts:
  message_ordering:
    description: "Messages are processed in FIFO order within same priority"
    guarantee: "strong"
  
  message_delivery:
    description: "At-least-once delivery guarantee"
    guarantee: "at-least-once"
  
  event_propagation:
    description: "Events are propagated synchronously to all listeners"
    guarantee: "synchronous"
  
  topic_isolation:
    description: "Topics are isolated from each other"
    guarantee: "strong"

performance_contracts:
  message_processing:
    target: "<10ms"
    percentile: "p99"
  
  throughput:
    target: ">10000 msg/sec"
    measurement: "sustained"
  
  event_emission:
    target: "<5ms"
    percentile: "p99"
  
  queue_operations:
    target: "<5ms"
    percentile: "p99"

metadata:
  created_at: "2025-01-10T12:40:00Z"
  updated_at: "2025-01-10T12:40:00Z"
  version: "2.0.0"
  status: "active"
  references:
    - "communication.manifest.yaml"
    - "communication.schema.yaml"