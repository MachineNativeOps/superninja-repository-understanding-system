# Communication Module Bundle
# Groups related artifacts for deployment

version: "2.0.0"
semantic_role: artifact_bundles
artifact_type: bundle
semantic_root: false

bundle:
  name: "communication"
  version: "1.0.0"
  description: "Communication layer deployment bundle"
  type: "module"

artifacts:
  manifest:
    path: "manifests/communication.manifest.yaml"
    type: "manifest"
    required: true
    checksum: "sha256:..."
  
  schema:
    path: "schemas/communication.schema.yaml"
    type: "schema"
    required: true
    checksum: "sha256:..."
  
  spec:
    path: "specs/communication.spec.yaml"
    type: "spec"
    required: true
    checksum: "sha256:..."
  
  policy:
    path: "policies/communication.policy.yaml"
    type: "policy"
    required: false
    checksum: "sha256:..."

source_code:
  - path: "src/communication/message-bus.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/communication/event-emitter.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/communication/topic-manager.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/communication/message-queue.ts"
    type: "typescript"
    checksum: "sha256:..."
  
  - path: "src/communication/index.ts"
    type: "typescript"
    checksum: "sha256:..."

dependencies:
  runtime:
    - name: "nodejs"
      version: ">=18.0.0"
    
    - name: "typescript"
      version: "^5.0.0"
  
  npm_packages:
    - name: "eventemitter3"
      version: "^5.0.0"
    
    - name: "uuid"
      version: "^9.0.0"

deployment:
  target_environments:
    - "development"
    - "staging"
    - "production"
  
  configuration:
    development:
      message_queue_size: 1000
      log_level: "debug"
    
    staging:
      message_queue_size: 5000
      log_level: "info"
    
    production:
      message_queue_size: 10000
      log_level: "warn"
  
  health_checks:
    - type: "http"
      endpoint: "/health"
      interval: "30s"
      timeout: "5s"
    
    - type: "tcp"
      port: 8080
      interval: "10s"
  
  resources:
    development:
      cpu: "500m"
      memory: "256Mi"
    
    staging:
      cpu: "1000m"
      memory: "512Mi"
    
    production:
      cpu: "2000m"
      memory: "1Gi"

validation:
  pre_deployment:
    - check: "artifact_integrity"
      description: "Verify artifact checksums"
    
    - check: "dependency_resolution"
      description: "Ensure all dependencies are available"
    
    - check: "schema_validation"
      description: "Validate against schema"
    
    - check: "policy_compliance"
      description: "Check policy compliance"
  
  post_deployment:
    - check: "health_check"
      description: "Verify service health"
    
    - check: "smoke_test"
      description: "Run basic functionality tests"
    
    - check: "performance_test"
      description: "Verify performance targets"

rollback:
  enabled: true
  automatic: true
  conditions:
    - "health_check_failed"
    - "error_rate > 0.05"
    - "latency_p99 > 50ms"
  
  strategy: "immediate"
  previous_version: "0.9.0"

metadata:
  created_at: "2025-01-10T12:40:00Z"
  updated_at: "2025-01-10T12:40:00Z"
  version: "2.0.0"
  status: "active"
  references:
    - "communication.manifest.yaml"
    - "communication.spec.yaml"
    - "communication.policy.yaml"
    - "endpoints.yaml"