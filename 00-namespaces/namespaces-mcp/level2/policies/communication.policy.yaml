# Communication Module Policy
# Defines access control and governance rules

version: "2.0.0"
semantic_role: policy_definitions
artifact_type: policy
semantic_root: false

access_control:
  rbac:
    roles:
      - name: "communication.admin"
        description: "Full access to communication module"
        permissions:
          - "communication:*"
      
      - name: "communication.publisher"
        description: "Can publish messages"
        permissions:
          - "communication:publish"
          - "communication:emit"
          - "communication:enqueue"
      
      - name: "communication.subscriber"
        description: "Can subscribe to topics and events"
        permissions:
          - "communication:subscribe"
          - "communication:listen"
          - "communication:dequeue"
      
      - name: "communication.viewer"
        description: "Read-only access"
        permissions:
          - "communication:list"
          - "communication:stats"
          - "communication:peek"

  permissions:
    - id: "communication:publish"
      description: "Publish messages to topics"
      resource: "topics/*"
      actions: ["publish"]
    
    - id: "communication:subscribe"
      description: "Subscribe to topics"
      resource: "topics/*"
      actions: ["subscribe", "unsubscribe"]
    
    - id: "communication:emit"
      description: "Emit events"
      resource: "events/*"
      actions: ["emit"]
    
    - id: "communication:listen"
      description: "Listen to events"
      resource: "events/*"
      actions: ["on", "once", "off"]
    
    - id: "communication:enqueue"
      description: "Add messages to queue"
      resource: "queue"
      actions: ["enqueue"]
    
    - id: "communication:dequeue"
      description: "Remove messages from queue"
      resource: "queue"
      actions: ["dequeue", "peek"]
    
    - id: "communication:list"
      description: "List topics and subscriptions"
      resource: "topics/*"
      actions: ["list"]
    
    - id: "communication:stats"
      description: "View statistics"
      resource: "topics/*"
      actions: ["stats"]

governance_rules:
  message_size:
    max_size: "1MB"
    enforcement: "strict"
    action: "reject"
  
  queue_size:
    max_size: 10000
    enforcement: "strict"
    action: "reject_new"
  
  topic_naming:
    pattern: "^[a-z][a-z0-9-]*$"
    enforcement: "strict"
    action: "reject"
  
  event_naming:
    pattern: "^[a-z][a-z0-9-]*$"
    enforcement: "strict"
    action: "reject"
  
  message_ttl:
    default: "24h"
    max: "7d"
    enforcement: "soft"
  
  subscriber_limit:
    max_per_topic: 1000
    enforcement: "soft"
    action: "warn"
  
  listener_limit:
    max_per_event: 100
    enforcement: "soft"
    action: "warn"

rate_limiting:
  publish:
    rate: "1000/s"
    burst: 2000
    scope: "per_user"
  
  subscribe:
    rate: "100/s"
    burst: 200
    scope: "per_user"
  
  emit:
    rate: "5000/s"
    burst: 10000
    scope: "per_user"

security_policies:
  encryption:
    in_transit: true
    at_rest: false
    algorithm: "AES-256-GCM"
  
  authentication:
    required: true
    methods:
      - "oauth2"
      - "api_key"
      - "jwt"
  
  authorization:
    model: "rbac"
    default_deny: true
  
  audit:
    enabled: true
    events:
      - "publish"
      - "subscribe"
      - "unsubscribe"
      - "emit"
      - "enqueue"
      - "dequeue"
    retention: "90d"

compliance:
  gdpr:
    enabled: true
    data_retention: "30d"
    right_to_erasure: true
  
  hipaa:
    enabled: false
  
  sox:
    enabled: false

monitoring:
  metrics:
    - "message_count"
    - "event_count"
    - "queue_size"
    - "subscriber_count"
    - "listener_count"
    - "error_rate"
    - "latency_p99"
  
  alerts:
    - condition: "queue_size > 8000"
      severity: "warning"
      action: "notify"
    
    - condition: "error_rate > 0.01"
      severity: "critical"
      action: "notify"
    
    - condition: "latency_p99 > 20ms"
      severity: "warning"
      action: "notify"

metadata:
  created_at: "2025-01-10T12:40:00Z"
  updated_at: "2025-01-10T12:40:00Z"
  version: "2.0.0"
  status: "active"
  references:
    - "communication.manifest.yaml"
    - "communication.spec.yaml"
    - "naming-registry.yaml"